sequenceDiagram
    participant U as User
    participant WF as Workflow Engine
    participant S as Summarizer Node
    participant R as Report Generator Node
    participant SB as Supabase Storage
    participant E as Email Node
    participant M as Mail Server

    U->>WF: Start workflow execution
    activate WF

    WF->>S: Execute summarizer
    activate S
    S-->>WF: Return summary text
    deactivate S

    WF->>R: Execute report generator
    activate R
    R-->>WF: Return report content (PDF/DOCX/CSV)
    deactivate R

    WF->>SB: Upload report to storage
    activate SB
    SB-->>WF: Return temporary file URL (valid 24h)
    deactivate SB

    WF->>E: Pass summary + file URL
    activate E
    E->>M: Send email
    activate M
    M-->>U: Deliver email with summary + report link
    deactivate M
    deactivate E

    WF-->>U: Notify workflow completed
    deactivate WF
